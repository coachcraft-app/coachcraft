---
import ListButton from "../ListButton.astro";
import TextInput from "../TextInput.astro";
import TextArea from "../TextArea.astro";
import Button from "../Button.astro";
import DropDown from "../DropDown.astro";
import CheckboxDropDown from "../CheckboxDropDown.astro";
import Image from "astro/components/Image.astro";
---

<div x-data class="flex flex-row justify-center max-h-full">
  <!-- left panel -->
  <div
    class="pr-[2.5vw]
          min-w-[13vw]
          overflow-y-auto
          flex flex-col gap-y-8
          pb-20"
    style="mask: linear-gradient(to bottom, black 0%, black 85%, transparent 100%);
    -webkit-mask: linear-gradient(to bottom, black 0%, black 85%, transparent 100%);"
  >
    <div class="flex flex-col gap-y-2">
      <Button
        type="button"
        label="Manage Lists"
        onClick="$store.pages.activities.onManageLists()"
      />
      <Button
        type="button"
        label="Create Activity"
        onClick="$store.pages.activities.createActivity()"
      />

      <DropDown
        options="$store.pages.activities.listsNames"
        defaultOption="All Activities"
        onOptionSwitch="$store.pages.activities.onListSwitch(listToSelect)"
      />
    </div>

    <!-- activities list -->
    <div x-data class="flex flex-col gap-y-3">
      <div x-data class="flex flex-col gap-y-1">
        <p class="text-sm text-gray-400">
          Activities:
          <span x-text="$store.pages.activities.selectedListActivities.length"
          ></span>
        </p>
        <hr class="border-gray-500/50" />
      </div>
      <template
        x-for="activity in $store.pages.activities.selectedListActivities"
        :key="activity.id"
      >
        <ListButton
          label="activity.name"
          id="activity.id"
          isSelected="isSelected() { return $store.pages.activities.selectedActivity == activity.id; }"
          onClick="$store.pages.activities.onActivitySelection(id)"
        />
      </template>
    </div>
  </div>

  <!-- right panel -->
  <div
    class="pl-[2.5vw]
          border-l-1
          border-l-gray-500/50
          grow
          max-w-[50vw]"
  >
    <!-- place holder for when no activity is selected -->
    <div
      x-data
      x-transition
      x-show="$store.pages.activities.rightPanelState == 'placeholder'"
      class="h-full w-full flex items-center justify-center"
    >
      <p class="text-gray-400 text-lg select-none">
        Select or Create new Activity to get started.
      </p>
    </div>

    <!-- manage lists -->
    <div
      x-data
      x-transition
      x-show="$store.pages.activities.rightPanelState == 'manage_lists'"
      class="h-full flex flex-col gap-25"
    >
      <div class="flex gap-5">
        <DropDown
          options="$store.pages.activities.listsNames"
          label="Select List"
          placeHolder="Select List"
          onOptionSwitch="$store.pages.activities.onManageListsListSwitch(listToSelect)"
        />
        <Button
          type="button"
          width="fit"
          label="Create New List"
          onClick="$store.pages.activities.onCreateNewList()"
        />
      </div>

      <div>
        <form
          class="flex flex-col gap-5"
          @submit.prevent="$store.pages.activities.onManageListsSaveChanges(event)"
        >
          <div class="flex items-center gap-5">
            <TextInput
              name="listName"
              label="List Name"
              required
              placeholder="List"
              value="$store.pages.activities.manageListsSelectedListObj?.name || ''"
            />
            <DropDown
              options="$store.pages.activities.listAccentColorNames"
              label="Accent Color"
              placeHolder="Accent Color"
              onOptionSwitch="$store.pages.activities.onManageListsAccentColorPreviewSwitch"
            />
          </div>

          <div class="flex gap-5 mt-5">
            <Button type="submit" width="fit" label="Save Changes" />
            <Button
              type="button"
              width="fit"
              label="Delete List"
              onClick="$store.pages.activities.onDeleteList()"
            />
          </div>
        </form>
      </div>
    </div>

    <!-- edit activity form -->
    <div
      class="flex flex-col gap-5"
      x-data
      x-transition:enter="transition ease-out duration-400"
      x-transition:enter-start="opacity-0 scale-85"
      x-transition:enter-end="opacity-100 scale-100"
      x-show="$store.pages.activities.rightPanelState == 'edit_activity'"
    >
      <!-- activity image -->
      <div x-data="{isEnlarged: false}">
        <div>
          <div
            class="aspect-[16/5]
                overflow-hidden
                rounded-lg
                w-full
                relative
                cursor-pointer
                select-none
                transition-all
                duration-300"
            @click="isEnlarged = true;"
          >
            <Image
              src="/images/activity_img_placeholder.jpg"
              alt="brand logo"
              width="500"
              height="200"
              class="w-full transition-all duration-300 brightness-90 hover:brightness-70"
            />

            <!-- edit button -->
            <button
              type="button"
              class="absolute
                   bottom-3
                   right-3
                   w-10
                   h-10
                   cursor-pointer
                   bg-white/90
                   hover:brightness-90
                   rounded-lg
                   shadow-lg
                   flex
                   items-center
                   justify-center
                   transition-colors
                   duration-200
                   z-10"
              @click.stop=""
            >
              <svg
                class="w-5 h-5 text-gray-700"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"
                ></path>
              </svg>
            </button>
          </div>
        </div>

        <!-- enlarged image popup -->
        <div
          x-show="isEnlarged"
          x-transition:enter="transition ease-out duration-300"
          x-transition:enter-start="opacity-0"
          x-transition:enter-end="opacity-100"
          x-transition:leave="transition ease-in duration-200"
          x-transition:leave-start="opacity-100"
          x-transition:leave-end="opacity-0"
          class="fixed inset-0 select-none z-50 flex items-center justify-center bg-black/80"
          x-on:keydown.esc.window="isEnlarged = false;"
          @click="isEnlarged = false;"
        >
          <div
            x-transition:enter="transition ease-out duration-300 delay-100"
            x-transition:enter-start="opacity-0 scale-75"
            x-transition:enter-end="opacity-100 scale-100"
            x-transition:leave="transition ease-in duration-200"
            x-transition:leave-start="opacity-100 scale-100"
            x-transition:leave-end="opacity-0 scale-75"
            class="relative max-w-4xl max-h-[90vh] mx-4"
            @click.stop
          >
            <!-- Close button -->
            <button
              type="button"
              class="absolute
                   -top-4
                   -right-4
                   w-10
                   h-10
                   cursor-pointer
                   bg-white
                   hover:bg-gray-100
                   rounded-full
                   shadow-lg
                   flex
                   items-center
                   justify-center
                   transition-colors
                   duration-200
                   z-10"
              @click="isEnlarged = false;"
            >
              <svg
                class="w-6 h-6 text-gray-700"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M6 18L18 6M6 6l12 12"></path>
              </svg>
            </button>

            <!-- Expanded image -->
            <Image
              src="/images/activity_img_placeholder.jpg"
              alt="Activity image"
              width="800"
              height="400"
              class="w-full h-auto rounded-lg shadow-2xl"
            />
          </div>
        </div>
      </div>

      <form
        class="flex flex-col gap-5"
        @submit.prevent="$store.pages.activities.onSaveChanges(event)"
      >
        <div
          class="flex
                  max-xl:flex-col
                  max-xl:max-w-full
                  gap-5"
        >
          <!-- xl: left-half -->
          <div class="flex flex-col gap-5 grow xl:max-w-1/2">
            <TextInput
              name="activityName"
              label="Activity Name"
              required
              placeholder="Activity"
              value="$store.pages.activities.selectedActivityObj?.name || ''"
            />
            <TextInput
              name="duration"
              label="Duration"
              required
              placeholder="HH:MM"
              value="$store.pages.activities.selectedActivityObj?.duration || ''"
              x-mask="99:99"
            />
            <TextArea
              name="description"
              label="Description"
              placeholder="Brief description such as sets, laps, plan, etc."
              rows="10"
              value="$store.pages.activities.selectedActivityObj?.description || ''"
            />
          </div>

          <!-- xl: right-half -->
          <div class="grow xl:max-w-1/2">
            <CheckboxDropDown
              label="Containing Lists"
              items="$store.pages.activities.listsNames"
              checkedItems="$store.pages.activities.containingListsNames"
              onUpdate="$store.pages.activities.onContainingListsUpdate(containingList)"
            />
          </div>
        </div>

        <div class="flex gap-5">
          <Button type="submit" label="Save Changes" width="fit" />
          <Button
            type="button"
            label="Reset Changes"
            width="fit"
            onClick="$store.pages.activities.onResetChanges()"
          />
          <Button
            type="button"
            label="Delete Activity"
            width="fit"
            onClick="$store.pages.activities.onDeleteActivity()"
          />
        </div>
      </form>
    </div>
  </div>
</div>
